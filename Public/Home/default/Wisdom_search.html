<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
		<title>{$title}-<yang:sitename /></title>
		<meta name="keywords" content="{$keywords}" />
		<meta name="description" content="{$description}" />
		<link rel="shortcut icon" href="" type="image/x-icon"/>
		<link href="__PUBLIC__/css/css.css?{$version}" rel="stylesheet" type="text/css" />
		<!--通用样式文件-->
		<link href="__PUBLIC__/css/common.css" rel="stylesheet" type="text/css" />
		<!--私有样式文件-->
		<link href="__PUBLIC__/css/educationwisdom.css?{$version}" rel="stylesheet" type="text/css" />
		<link href="__PUBLIC__/css/Wisdomclassroom.css?{$version}" rel="stylesheet" type="text/css" />
		<link href="__PUBLIC__/css/Wisdomclassroom_common.css?{$version}" rel="stylesheet" type="text/css" />
		<!--分页样式文件-->
		<link href="__PUBLIC__/css/jPages.css?{$version}" rel="stylesheet" type="text/css" />                   
        <link href="__PUBLIC__/static/bootstrap.min.css" rel="stylesheet">
        <link href="__PUBLIC__/static/bootstrap-table.min.css" rel="stylesheet">
        <style>
            .fixed-table-pagination .pagination-detail, .fixed-table-pagination div.pagination{                        
                margin-top: 13px;
                margin-bottom: 15px;
                margin-right: 15%;
            }                    
        </style>
		<script type="text/javascript">
			var app_path = "__ROOT__";
			var public_path = "__PUBLIC__";			
		</script>                       
	</head>    
	<body>
		<div class="main search-page wisdom-ketang">
			<!--头部-->
            <div class="common-top" style="margin-top:-75px;">
            	<include file="Public:head" />
            </div>				
			<!--主体内容区域-->
			<div class="page-content article-content w1002">
				<div class="page-content-right ketang" id="ketang">
				    <div class="xiaoguo">
						<span class="first-ci">学段：</span>
                        <p>
                            <volist name='type_list' id='vo'>
                                <span onclick="topic_list({$vo['id']})" id="type_id_{$vo['id']}">{$vo.type_name}</span>						 	
                            </volist>						 		
						</p>
					</div>
					<div class="xiaoguo">
						<span class="first-ci">科目：</span>
						<p id='eq_topic_id'>
                            <if condition="$type_id neq 0"> 
                                <volist name='topic_list' id='vo'>
                                    <span onclick="ver_list({$vo['id']})" id="topic_id_{$vo['id']}">{$vo.topic_name}</span>						 	
                                </volist>
                            <else/>    
                                <span>语文</span>	
                            </if>                                                  															   
                            </p>
			    	</div>
			    	<div class="xiaoguo">
                        <span class="first-ci">版本：</span>
                        <p id='eq_ver_id'>
                            <if condition="$topic_id neq 0"> 
                                <volist name='ver_list' id='vo'>
                                  <span onclick="seg_list({$vo['id']})" id="ver_id_{$vo['id']}">{$vo.ver_name}</span>						 	
                                </volist>
                            <else/>    
                                <span>苏教版</span>           
                            </if>                                            
                        </p>
			    	</div>
			    	<div class="xiaoguo">
                        <span class="first-ci">年级段：</span>
                        <p id='eq_seg_id'>
                        <if condition="$ver_id neq 0"> 
                            <volist name='seg_list' id='vo'>
                              <span onclick="seg_id({$vo['id']})" id="seg_id_{$vo['id']}">{$vo.seg_name}</span>						 	
                            </volist>
                        <else/>    
                            <span>一年级上册</span>                
                        </if>                            
			    	</div>		
                                <div class="course-name">
                                    <table id="tbl">
                                        <thead>
                                            <tr>
                                                <th>课程名称</th>
                                                <th>教师</th>
                                                <th>创建日期</th>  
                                                <th>属性</th>
                                            </tr>
                                        </thead>                         
                                    </table>
                                </div>                                                         
				</div>                          
				<div class="page-content-left"  style="margin-right:0;">
					<div class="page-content-header"><p>课程搜索</p></div>
                                        <form method="post" id="form_adv_search"  method="post" action="{:U('search')}">        
                                            <div class="search search-lesson">                                                 
                                                <input type="text" id='title' name='title' style="font-family:'microsoft yahei';width:170px;" value="{$title}"">
                                                <input type="hidden" name="type_id" id="type_id" value="{$type_id}">
                                                <input type="hidden" name="topic_id" id="topic_id" value="{$topic_id}">
                                                <input type="hidden" name="ver_id" id="ver_id" value="{$ver_id}">
                                                <input type="hidden" name="seg_id" id="seg_id" value="{$seg_id}">
                                                <input type="hidden" id='cid' name='lessonflag' value=''>
                                                    <div class="customSelectStyle">
                                                    <div class="customSelectValue">全部</div>
                                                    <div class="customSelectBtn"></div>
                                                        <div class="customSelectValueList">
                                                            <p class="listValue" data-delid="">全部</p>
                                                            <p class="listValue" data-delid="0">精品</p>
                                                            <p class="listValue" data-delid="1">微课</p>        
                    <!--                                        <volist name="model_list" id="vo">
                                                               <p class="listValue" data-delid="{$vo.id}">{$vo.name}</p>        
                                                            </volist>                       -->
                                                        </div>
                                                    </div>
                                                    <img src="__PUBLIC__/images/teach/icon-search.jpg" onclick="document.getElementById('submint').click();return false;" style="curosr:pointer">
                                                </div>
                                            <div class="search-btn hidden" onclick="sub()" id="submint">搜索</div> 
                                        </form>
                                        <div class="new-article new-article-content">
						<div class="new-article-header">最新课程</div>
						<ul class="new-article-list">
							<volist name="del_list" id="vo">  
								<li style="height:62px;background:url({:$vo['imgs']});background-repeat:no-repeat;background-position:left center;">
									<a href="#" class="res_id" data-id='{$vo.id}' >
									<span>{:str2sub($vo['title'],12,$flag = 1,$sp = '...')}</span>
									<span class="time">上传于{$vo.publishtime|date='Y-m-d H:i:s', ###}</span>
									</a>
								</li>			
							</volist>   
						</ul>
					</div>					
					<div class="new-article">
					<div class="new-article-header">热门课程</div>
						<ul class="new-article-list">
							<volist name="del_list_dow" id="vo">  
								<li style="height:62px;background:url({:$vo['imgs']});background-repeat:no-repeat;background-position:left center;">
									<a href="#" class="res_id" data-id='{$vo.id}' >
									<span>{:str2sub($vo['title'],12,$flag = 1,$sp = '...')}</span>
									<span class="time">上传于{$vo.publishtime|date='Y-m-d H:i:s', ###}</span>
									</a>
								</li>			
							</volist>   
						</ul>
					</div>
				</div>
			</div>
		</div>
		<!-- <include file="Public:footer" /--> 
		<!--jquery库-->
		<script type="text/javascript" src="__PUBLIC__/js/common.js"></script>		
		<!--自定义select-->
		<script type="text/javascript" src="__PUBLIC__/js/select.js"></script>	  
        <!--自定义js插件-->           
        <script src="__PUBLIC__/static/bootstrap.min.js"></script>
        <script src="__PUBLIC__/static/bootstrap-table.min.js"></script>
        <script src="__PUBLIC__/static/bootstrap-table-zh-CN.min.js"></script>
        <script src="__PUBLIC__/js/news.js" type="text/javascript"></script>
	</body>
</html>

 <script type="text/javascript" language="javascript">        
    $(function () {
        var type_id = $('#type_id').val();        
        if(!(type_id == undefined)){            
            $('#type_id_'+type_id).css({"padding":"6px 19px","border":"2px solid #E5864B"});
        } 
        var topic_id = $('#topic_id').val();            
        if(!(topic_id == undefined)){            
            $('#topic_id_'+topic_id).css({"padding":"6px 19px","border":"2px solid #E5864B"});
        } 
        var ver_id = $('#ver_id').val();        
        if(!(ver_id == undefined)){            
            $('#ver_id_'+ver_id).css({"padding":"6px 19px","border":"2px solid #E5864B"});
        } 
        var seg_id = $('#seg_id').val();        
        if(!(seg_id == undefined)){            
            $('#seg_id_'+seg_id).css({"padding":"6px 19px","border":"2px solid #E5864B"});
        }
        more_select();
    });   
     
    function more_select(){         
        var aArray = {};
        aArray['type_id'] = $('#type_id').val();
        aArray['topic_id'] = $('#topic_id').val();  
        aArray['ver_id'] = $("#ver_id").val();
        aArray['seg_id'] = $("#seg_id").val(); 
        aArray['title'] = $("#title").val(); 
        aArray['lessonflag'] = $("#cid").val();
        initTable(aArray);         
    }  
    function topic_list(id){
        $('#type_id').val(id);
        $('#topic_id').val('');
        $('#ver_id').val('');
        $('#seg_id').val('');               
        sendAjax( "{:U('get_topic_list')}", "type_id="+id, function(data) {
            $("#eq_topic_id span").remove();//先清除数据
            $("#eq_ver_id span").remove();//先清除数据  
            $("#eq_seg_id span").remove();//先清除数据            
            $("#eq_ver_id").append("<span>选择版本</span>");//赋值
            $("#eq_seg_id").append("<span>选择年级</span>");//赋值            
            $.each(data.items, function (i, item) {                                       
                $("#eq_topic_id").append("<span onclick='ver_list("+item.id+")'>"+item.name+"</span>");//赋值                	
            });   
        });      
        more_select();  
    }; 
    
    function ver_list(id){
        $('#topic_id').val(id);
        $('#ver_id').val('');
        $('#seg_id').val('');         
        sendAjax( "{:U('get_ver_list')}", "topic_id="+id, function(data) {           
            $("#eq_ver_id span").remove();//先清除数据  
            $("#eq_seg_id span").remove();//先清除数据               
            $("#eq_seg_id").append("<span>选择年级</span>");//赋值            
            $.each(data.items, function (i, item) {                                       
                $("#eq_ver_id").append("<span onclick='seg_list("+item.id+")'>"+item.name+"</span>");//赋值                	
            });   
        });     
        more_select();  
    };  
	
    function seg_list(id){
        $('#ver_id').val(id);
        $('#seg_id').val('');        
        sendAjax( "{:U('get_seg_list')}", "ver_id="+id, function(data) {             
            $("#eq_seg_id span").remove();//先清除数据                      
            $.each(data.items, function (i, item) {                                       
                $("#eq_seg_id").append("<span onclick='seg_id("+item.id+")'>"+item.name+"</span>");//赋值                	
            });   
        });     
        more_select();  
    };
	
    function seg_id(id){
        $('#seg_id').val(id);
        more_select();    
    };  
    
    function sub(){      
        more_select();    
    }; 

     //选择加边框效果 
    $(".xiaoguo").on("click",".xiaoguo>p span",function(){
        $(this).css(
        {
       	"padding":"6px 19px",
        "border":"2px solid #E5864B"
        }
        )
        .siblings().css({
        	"border":"1px solid #d7d7d7",
        	"padding":"7px 20px"
    	});
    });   
    
    function initTable(aArray) {       
        $('#tbl').bootstrapTable('destroy');        
        $("#tbl").bootstrapTable({
            method: "get",
            url:"{:U('res')}",
            striped:true, 
            pagination:true,             
            pageSize:5,       
            pageNumber:1,            
            pageList: [5, 10, 15, 20, 25],  
            sidePagination:"server", 
            paginationFirstText: "首页",
            paginationPreText:"上一页",
            paginationNextText:"下一页",
            paginationLastText:"尾页",
            queryParamsType : "undefined",           
            queryParams:function queryParams(params) {   
                var param = {                    
                    page: params.pageNumber,
                    aArray: aArray,
                    pageSize: params.pageSize,                                     
                    account:$('#account').val(),
                    start: $("#start").val(),
                    end: $("#end").val(),
                    sortName: this.sortName,

                }                
                return param;
            },
            onLoadSuccess: function(res){        
                var res_list = '';  
                if(res.total == 0){
                    $('.fixed-table-loading').text('无相关数据');
                }                
                $.each(res.rows, function (i, item) {               
                    res_list +='<tr><td><a><img src="'+item.litpic+'" style="width: 120px;height:80px;"></a><div class="qiugu"><h4>';
                    res_list += '<a style="cursor:pointer;" data-resid="'+item.res_id+'"data-id="'+item.id+'" class="'+is_flag(item.lessonflag)+'">';
                    res_list += item.title+'</a></h4><p>'+item.type_name+'-'+item.topic_name+'-'+item.ver_name+'-'+item.seg_name+'</p><div>';           
                    res_list +=  '开课次数：'+item.authorcnt+'&nbsp;上课次数：'+item.visitorcnt+'&nbsp;浏览人数：'+item.browsecnt;
                    res_list += '</div></div></td><td>'+item.username+'</td><td>';
                    res_list += date("Y-m-d H:i:s",item.publishtime)+'</td><td><p>';
                    res_list += is_jur(item.jur)+'</p></td></tr>';                   
                });         
                $('#tbl tbody').html(res_list);  
                $('.pagination-detail').remove(); 
                return false;
            },
            onLoadError: function(){  
                console.log("加载数据失败");
            },
        });
    }
    
    $(document).on("click", ".res_id", function () { 
        var id = $(this).attr('data-id');      
        location.href="{:U('detail')}&id="+id;
    }); 
    
    $(document).on("click", ".res_id_flag", function () { 
        var id = $(this).attr('data-id'); 
        var resid = $(this).attr('data-resid');      
        window.location.href = "{:U('attendlesson')}&id="+id+"&res_id="+resid;  
    });
     
    function is_jur(jur) {
       if (jur == 1) {
           return '个人私密';
       } else if (jur == 2) {
           return '学校公开';
       } else if (jur == 3) {
           return '完全公开';
       } else {
           return '未知';
       }
    }
   
    function is_flag(lessonflag) {
       if (lessonflag == 1) {
           return 'res_id';
       } else if (lessonflag == 2) {         
           return 'res_id_flag';
       } else {         
           return '未知';
       }
   }
   
  
</script>